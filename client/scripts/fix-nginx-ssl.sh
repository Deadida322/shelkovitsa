#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏..."

# 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º nginx
echo "‚èπÔ∏è  –û—Å—Ç–∞–Ω–æ–≤–∫–∞ nginx..."
sudo systemctl stop nginx

# 2. –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ HTTP-only –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
echo "üîß –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ HTTP-only –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é..."
sudo cp ../deploy/nginx-http-only.conf /etc/nginx/nginx.conf

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx..."
if sudo nginx -t; then
    echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ (HTTP —Ç–æ–ª—å–∫–æ)"
    
    # 4. –ó–∞–ø—É—Å–∫–∞–µ–º nginx
    echo "üöÄ –ó–∞–ø—É—Å–∫ nginx..."
    sudo systemctl start nginx
    sudo systemctl enable nginx
    
    # 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
    echo "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞..."
    sudo systemctl status nginx --no-pager
    
    echo ""
    echo "‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Å SSL –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞!"
    echo "üåê Nginx —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ HTTP (–ø–æ—Ä—Ç 80)"
    echo "üí° –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è SSL –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: ./scripts/setup-ssl.sh"
    
else
    echo "‚ùå –û—à–∏–±–∫–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx"
    echo "üìã –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—à–∏–±–∫–∏:"
    sudo nginx -t
    exit 1
fi
