#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–±–æ—Ä–∫–∏ SSR –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

echo "üöÄ –°–±–æ—Ä–∫–∞ SSR –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
npm ci

# –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
echo "üî® –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
npm run build

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
if [ -d ".output" ]; then
    echo "‚úÖ SSR –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω–æ –≤ –ø–∞–ø–∫–µ .output/"
    echo "üìÅ –†–∞–∑–º–µ—Ä –ø–∞–ø–∫–∏ .output:"
    du -sh .output/
    echo "üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–±–æ—Ä–∫–∏:"
    ls -la .output/
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ server —Ñ–∞–π–ª–∞
    if [ -f ".output/server/index.mjs" ]; then
        echo "‚úÖ Server —Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω: .output/server/index.mjs"
    else
        echo "‚ùå –û—à–∏–±–∫–∞: server —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
        exit 1
    fi
else
    echo "‚ùå –û—à–∏–±–∫–∞: –ø–∞–ø–∫–∞ .output –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
    exit 1
fi

echo "üéâ –ì–æ—Ç–æ–≤–æ! SSR –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é."
echo "üí° –î–ª—è –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: node .output/server/index.mjs"
echo "üí° –ò–ª–∏ —Å PM2: pm2 start ecosystem.config.js"
