# Переменные окружения для nginx конфигурации
# Скопируйте этот файл в /etc/nginx/conf.d/ и настройте под ваши нужды

# Основные настройки домена
map $host $domain {
    default shelkovitsa.ru;
    ~^www\.(.+)$ $1;
}

# Настройки для разных окружений
map $host $api_backend {
    default 127.0.0.1:3000;
    ~^dev\. shelkovitsa.ru:3000;
    ~^staging\. shelkovitsa.ru:3001;
}

map $host $frontend_backend {
    default 127.0.0.1:3001;
    ~^dev\. shelkovitsa.ru:3001;
    ~^staging\. shelkovitsa.ru:3002;
}

# Настройки SSL
map $host $ssl_cert {
    default /etc/ssl/certs/shelkovitsa.ru.crt;
    ~^dev\. /etc/ssl/certs/dev.shelkovitsa.ru.crt;
    ~^staging\. /etc/ssl/certs/staging.shelkovitsa.ru.crt;
}

map $host $ssl_key {
    default /etc/ssl/private/shelkovitsa.ru.key;
    ~^dev\. /etc/ssl/private/dev.shelkovitsa.ru.key;
    ~^staging\. /etc/ssl/private/staging.shelkovitsa.ru.key;
}

# Настройки кэширования
map $request_uri $cache_control {
    ~*\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ "public, max-age=31536000, immutable";
    ~*\.(html)$ "public, max-age=3600";
    default "no-cache";
}

# Настройки безопасности
map $http_user_agent $blocked_agent {
    default 0;
    ~*malicious 1;
    ~*bot 1;
    ~*crawler 1;
}
